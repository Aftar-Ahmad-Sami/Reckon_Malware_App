import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';

import 'sign_in.dart';

class ForgetPassword extends StatefulWidget {
  const ForgetPassword({super.key});

  @override
  State<ForgetPassword> createState() => _ForgetPasswordState();
}

class _ForgetPasswordState extends State<ForgetPassword> {
  final formkey = GlobalKey<FormState>();
  void validate() {
    if (formkey.currentState!.validate()) {
      // print("sucess");
    }
  }

  final emailController = TextEditingController();

  final auth = FirebaseAuth.instance;

  @override
  Widget build(BuildContext context) {
    var widthx = MediaQuery.of(context).size.width;
    //var heightx = MediaQuery.of(context).size.height;

    return Scaffold(
      extendBodyBehindAppBar: true,
      appBar: AppBar(
        leading: IconButton(
          icon: const Icon(
            Icons.arrow_back_ios_new_rounded,
            color: Colors.white,
          ),
          onPressed: () {
            Navigator.push(context,
                MaterialPageRoute(builder: (context) => const SignIn()));
          },
        ),
        // title: const Text(
        //   'Back',
        //   style: TextStyle(
        //     color: Colors.black,
        //     fontWeight: FontWeight.bold,
        //   ),
        // ),
        backgroundColor: Colors.transparent,
        elevation: 0,
      ),
      body: Stack(children: [
        Container(
          width: double.infinity,
          height: double.infinity,
          decoration: const BoxDecoration(
            gradient: LinearGradient(
              colors: [
                Color.fromARGB(255, 23, 54, 94),
                Color.fromARGB(255, 3, 29, 29),
              ],
              begin: Alignment.topLeft,
              end: Alignment.bottomRight,
            ),
          ),
        ),
        // Padding(
        //   padding: const EdgeInsets.fromLTRB(40, 50, 0, 0),
        //   child: InkWell(
        //     onTap: () {
        //       Navigator.push(
        //           context, MaterialPageRoute(builder: (context) => SignIn()));
        //     },
        //     child: const Text(
        //       'Back',
        //       style: TextStyle(
        //           fontWeight: FontWeight.bold,
        //           color: Colors.white,
        //           fontSize: 18),
        //     ),
        //   ),
        // ),
        Center(
          child: SingleChildScrollView(
              child: Form(
            key: formkey,
            child: Column(children: [
              const Icon(
                Icons.lock_reset_outlined,
                size: 150,
                color: Colors.white,
              ),
              const Text(
                'Forget Password?',
                style: TextStyle(
                    fontWeight: FontWeight.bold,
                    color: Colors.white,
                    fontSize: 18),
              ),
              const SizedBox(
                height: 20,
              ),
              const Text(
                'We just need your registered email address',
                style: TextStyle(
                    fontWeight: FontWeight.bold,
                    color: Color.fromARGB(255, 128, 124, 124),
                    fontSize: 12),
              ),
              const Text(
                'to send you password reset',
                style: TextStyle(
                    fontWeight: FontWeight.bold,
                    color: Color.fromARGB(255, 128, 124, 124),
                    fontSize: 12),
              ),
              const SizedBox(
                height: 100,
              ),

              SizedBox(
                width: widthx * 0.8,
                child: TextFormField(
                  controller: emailController,
                  style: const TextStyle(
                    fontFamily: 'Itim',
                    fontSize: 18,
                    color: Colors.white,
                  ),
                  decoration: const InputDecoration(
                      prefixIcon: Icon(
                        Icons.email,
                        color: Colors.grey,
                      ),
                      hintText: "Email",
                      hintStyle: TextStyle(color: Colors.grey),
                      focusedBorder: UnderlineInputBorder(
                          borderSide: BorderSide(color: Colors.yellow)),
                      enabledBorder: UnderlineInputBorder(
                          borderSide: BorderSide(color: Colors.white))),
                  validator: (val) {
                    if (val!.isEmpty) {
                      return "Email is empty";
                    } else {
                      return null;
                    }
                  },
                ),
              ),

              const SizedBox(height: 30),

              //sign in button

              SizedBox(
                width: widthx * 0.9,
                height: 50,
                child: ElevatedButton(
                  onPressed: () async {
                    if (formkey.currentState!.validate()) {
                      try {
                        await FirebaseAuth.instance.sendPasswordResetEmail(
                            email: emailController.text);
                        // BuildContext can't be in async function
                        Future.delayed(Duration.zero).then((value) =>
                            ScaffoldMessenger.of(context)
                                .showSnackBar(const SnackBar(
                              content: Text('Reset password email sent'),
                            )));
                      } catch (e) {
                        if (emailController.text == "") {
                          // BuildContext can't be in async function
                          Future.delayed(Duration.zero).then((value) =>
                              ScaffoldMessenger.of(context)
                                  .showSnackBar(const SnackBar(
                                content: Text('E M P T Y   F I E L D'),
                              )));
                        } else {
                          ScaffoldMessenger.of(context)
                              .showSnackBar(const SnackBar(
                            content: Text("I N C O R R E C T   E M A I L"),
                          ));
                        }
                      }
                    }
                  },
                  //validate,
                  child: const Text('Send Email'),
                  style: ElevatedButton.styleFrom(
                    textStyle: const TextStyle(
                      fontWeight: FontWeight.bold,
                      fontSize: 20,
                    ),
                    backgroundColor: const Color.fromARGB(255, 19, 155, 30),
                    foregroundColor: const Color.fromARGB(255, 194, 167, 167),
                    shape: const RoundedRectangleBorder(
                        borderRadius: BorderRadius.all(Radius.circular(15))),
                  ),
                ),
              ),

              // SizedBox(height: 160),
              // SizedBox(
              //   child: Text(
              //     "Â© Team Wreck-On",
              //     textAlign: TextAlign.center,
              //     style: TextStyle(
              //         fontWeight: FontWeight.bold,
              //         fontSize: 15,
              //         color: Colors.blueGrey),
              //   ),
              // )
              //   ),
            ]),
          )),
        )
      ]),
    );
  }
}
